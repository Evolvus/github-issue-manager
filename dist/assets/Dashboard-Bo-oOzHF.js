import{c as R,j as e,I,C as d,a as h,b as x,d as m,B as w}from"./index-D9dTo_Rc.js";import{r as g,u as ee}from"./react-vendor-Dku4jBrG.js";import{B as K}from"./badge-Dce5Ri_g.js";import{A as se,a as te,b as ne}from"./avatar-C9-6Q88m.js";import{T as ae}from"./TimeAgo-C9ktNgaz.js";import{S as ce}from"./search-D7kZdEDu.js";import{R as N,L as X,C as B,X as E,Y as F,T as k,a as D,b as C,P as q,c as U,d as H,B as re,e as le}from"./chart-vendor-BKNShu6q.js";const oe=R("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);function ie(c="?"){const l=c.split(/\s+|\//g).filter(Boolean),o=l[0]?.[0]||"?",i=l[1]?.[0]||"";return(o+i).toUpperCase()}function de(c){const l=parseInt(c.substr(0,2),16),o=parseInt(c.substr(2,2),16),i=parseInt(c.substr(4,2),16);return(.299*l+.587*o+.114*i)/255>.5?"#000000":"#ffffff"}function M(c=30){const l=[],o=new Date;for(let i=c-1;i>=0;i--){const u=new Date(o);u.setDate(o.getDate()-i),l.push(u.toISOString().slice(0,10))}return l}function z(c=12){const l=[],o=new Date;for(let i=c-1;i>=0;i--){const u=new Date(o.getFullYear(),o.getMonth()-i,1);l.push(u.toISOString().slice(0,7))}return l}function Ne({allIssues:c,allIssuesWithStatus:l,orgMeta:o,query:i,setQuery:u,range:y,setRange:O,burnRange:b,setBurnRange:T,setFilterAssignee:he,setFilterState:xe,setFilterProjectStatus:me,setFilterTag:je,setFilterIssueType:fe}){const G=g.useMemo(()=>{if(y==="year"){const s=z(12),n=Object.fromEntries(s.map(t=>[t,{date:t,opened:0,closed:0}]));for(const t of c){const a=t.createdAt?.slice(0,7);if(n[a]&&n[a].opened++,t.closedAt){const r=t.closedAt.slice(0,7);n[r]&&n[r].closed++}}return Object.values(n)}else{const s=M(y==="week"?7:30),n=Object.fromEntries(s.map(t=>[t,{date:t,opened:0,closed:0}]));for(const t of c){const a=t.createdAt?.slice(0,10);if(n[a]&&n[a].opened++,t.closedAt){const r=t.closedAt.slice(0,10);n[r]&&n[r].closed++}}return Object.values(n)}},[c,y]),V=g.useMemo(()=>b==="year"?z(12).map(n=>{const t=new Date(n+"-01"),a=new Date(t);a.setMonth(a.getMonth()+1);const r=c.filter(f=>{const p=new Date(f.createdAt),v=f.closedAt?new Date(f.closedAt):null;return p<a&&(!v||v>=a)}).length,j=c.filter(f=>{const p=new Date(f.createdAt),v=f.closedAt?new Date(f.closedAt):null;return p<a&&v&&v<a}).length;return{date:n,open:r,closed:j}}):M(b==="week"?7:30).map(n=>{const t=new Date(n);t.setDate(t.getDate()+1);const a=c.filter(j=>{const f=new Date(j.createdAt),p=j.closedAt?new Date(j.closedAt):null;return f<t&&(!p||p>=t)}).length,r=c.filter(j=>{const f=new Date(j.createdAt),p=j.closedAt?new Date(j.closedAt):null;return f<t&&p&&p<t}).length;return{date:n,open:a,closed:r}}),[c,b]),J=s=>{if(y==="year")return new Date(s+"-01").toLocaleString("default",{month:"short"});const n=s.slice(8,10),t=s.slice(5,7);return`${n}/${t}`},Q=s=>{if(b==="year")return new Date(s+"-01").toLocaleString("default",{month:"short"});const n=s.slice(8,10),t=s.slice(5,7);return`${n}/${t}`},$=g.useMemo(()=>[...c].sort((s,n)=>new Date(n.createdAt)-new Date(s.createdAt)).slice(0,5),[c]),P=g.useMemo(()=>{const s=new Map;for(const n of c){const t=n.assignees.length?n.assignees:[{login:"(unassigned)",avatarUrl:"",url:"#"}];for(const a of t){const r=a.login||"(unassigned)";s.has(r)||s.set(r,{assignee:a,issues:[]}),s.get(r).issues.push(n)}}return Array.from(s.values()).sort((n,t)=>t.issues.length-n.issues.length)},[c]),Y=g.useMemo(()=>P.slice(0,10),[P]),Z=g.useMemo(()=>{const s={"<7":0,"7-30":0,"31-90":0,">90":0},n=new Date;for(const t of c){if(t.state!=="OPEN")continue;const a=(n-new Date(t.createdAt))/864e5;a<7?s["<7"]++:a<30?s["7-30"]++:a<90?s["31-90"]++:s[">90"]++}return Object.entries(s).map(([t,a])=>({range:t,value:a}))},[c]),W=g.useMemo(()=>{const s=c.filter(t=>t.closedAt);return s.length?s.reduce((t,a)=>t+(new Date(a.closedAt)-new Date(a.createdAt)),0)/s.length/864e5:0},[c]),_=g.useMemo(()=>{const s=new Map,n=new Date;n.setDate(n.getDate()-30);for(const t of c){if(!t.closedAt||new Date(t.closedAt)<n)continue;const r=t.assignees.length?t.assignees:[{login:"(unassigned)"}];for(const j of r)s.set(j.login,(s.get(j.login)||0)+1)}return Array.from(s.entries()).map(([t,a])=>({login:t,count:a})).sort((t,a)=>a.count-t.count)},[c]),L=g.useMemo(()=>{const s=new Map;for(const t of c){if(t.state!=="OPEN")continue;const a=t.issueType?.name||"(none)",r=a.toLowerCase();s.has(r)||s.set(r,{name:a,value:0}),s.get(r).value++}const n={bug:"ef4444",feature:"22c55e",task:"3b82f6","(none)":"a52a2a"};return Array.from(s.values()).map(t=>({...t,color:n[t.name.toLowerCase()]||"6b7280"}))},[c]),S=g.useMemo(()=>{const s=new Map;for(const t of c){if(t.state!=="CLOSED")continue;const a=t.issueType?.name||"(none)",r=a.toLowerCase();s.has(r)||s.set(r,{name:a,value:0}),s.get(r).value++}const n={bug:"ef4444",feature:"22c55e",task:"3b82f6","(none)":"a52a2a"};return Array.from(s.values()).map(t=>({...t,color:n[t.name.toLowerCase()]||"6b7280"}))},[c]),A=g.useMemo(()=>{const s=l.filter(r=>r.state==="OPEN").length,n=l.filter(r=>r.state==="CLOSED").length,t=l.filter(r=>r.project_status==="Backlog").length,a=l.filter(r=>["Ready","In progress","In review"].includes(r.project_status)).length;return{open:s,closed:n,backlog:t,thisSprint:a}},[l]);return ee(),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[o&&e.jsxs("a",{href:o.url,target:"_blank",rel:"noreferrer",className:"text-sm text-blue-600 inline-flex items-center gap-1",children:[o.name," ",e.jsx(oe,{className:"w-3 h-3"})]}),e.jsx("div",{className:"ml-auto flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"w-4 h-4 absolute left-2 top-1/2 -translate-y-1/2"}),e.jsx(I,{"data-quick-open":!0,placeholder:"Search issues...",value:i,onChange:s=>u(s.target.value),className:"pl-7 w-60"})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Open"})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold",children:A.open})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Closed"})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold",children:A.closed})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Backlog"})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold",children:A.backlog})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"This Sprint"})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold",children:A.thisSprint})})]})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Sprint Burndown Chart"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{className:b==="week"?"bg-black text-white":"bg-white text-black border",onClick:()=>T("week"),children:"Week"}),e.jsx(w,{className:b==="month"?"bg-black text-white":"bg-white text-black border",onClick:()=>T("month"),children:"Month"}),e.jsx(w,{className:b==="year"?"bg-black text-white":"bg-white text-black border",onClick:()=>T("year"),children:"Year"})]})]})}),e.jsx(m,{children:e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(X,{data:V,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"date",tickFormatter:Q}),e.jsx(F,{allowDecimals:!1}),e.jsx(k,{}),e.jsx(D,{}),e.jsx(C,{type:"monotone",dataKey:"open",name:"Open Issues",stroke:"#3b82f6"}),e.jsx(C,{type:"monotone",dataKey:"closed",name:"Closed Issues",stroke:"#ef4444"})]})})})})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs(d,{className:"md:col-span-2",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{children:"Opened vs Closed"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{className:y==="week"?"bg-black text-white":"bg-white text-black border",onClick:()=>O("week"),children:"Week"}),e.jsx(w,{className:y==="month"?"bg-black text-white":"bg-white text-black border",onClick:()=>O("month"),children:"Month"}),e.jsx(w,{className:y==="year"?"bg-black text-white":"bg-white text-black border",onClick:()=>O("year"),children:"Year"})]})]})}),e.jsx(m,{children:e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(X,{data:G,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"date",tickFormatter:J}),e.jsx(F,{allowDecimals:!1}),e.jsx(k,{}),e.jsx(D,{}),e.jsx(C,{type:"monotone",dataKey:"opened",name:"Opened",stroke:"#22c55e"}),e.jsx(C,{type:"monotone",dataKey:"closed",name:"Closed",stroke:"#ef4444"})]})})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Issue Types"})}),e.jsx(m,{children:L.length?e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(q,{children:[e.jsx(U,{data:L,dataKey:"value",nameKey:"name",label:!0,children:L.map((s,n)=>e.jsx(H,{fill:`#${s.color}`},`cell-${n}`))}),e.jsx(k,{}),e.jsx(D,{})]})})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No issue types found."})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Closed Issues by Type"})}),e.jsx(m,{children:S.length?e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(q,{children:[e.jsx(U,{data:S,dataKey:"value",nameKey:"name",label:!0,children:S.map((s,n)=>e.jsx(H,{fill:`#${s.color}`},`closed-cell-${n}`))}),e.jsx(k,{}),e.jsx(D,{})]})})}):e.jsx("p",{className:"text-sm text-gray-500",children:"No issue types found."})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Latest 5 Issues"})}),e.jsx(m,{children:e.jsxs("ul",{className:"space-y-3",children:[$.map(s=>e.jsxs("li",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("a",{href:s.url,target:"_blank",rel:"noreferrer",className:"font-medium hover:underline truncate block",children:["#",s.number," ",s.title]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.repository?.nameWithOwner," â€¢ ",e.jsx(ae,{iso:s.createdAt})]}),e.jsx("div",{className:"mt-1 flex flex-wrap gap-1",children:s.labels.map(n=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",style:{backgroundColor:`#${n.color}`,color:de(n.color)},children:n.name},n.id))})]}),e.jsx(K,{children:s.state})]},s.id)),!$.length&&e.jsx("div",{className:"text-sm text-gray-500",children:"No data available."})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Top 10 Assignees"})}),e.jsx(m,{children:e.jsxs("div",{className:"space-y-3",children:[Y.map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(se,{className:"w-7 h-7",children:[e.jsx(te,{src:s.assignee.avatarUrl}),e.jsx(ne,{children:ie(s.assignee.login)})]}),e.jsx("a",{href:s.assignee.url,target:"_blank",rel:"noreferrer",className:"text-sm hover:underline",children:s.assignee.login})]}),e.jsx(K,{variant:"secondary",children:s.issues.length})]},s.assignee.login)),!Y.length&&e.jsx("p",{className:"text-sm text-gray-500",children:"No assignees found."})]})})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Issue Aging"})}),e.jsx(m,{children:e.jsx("div",{className:"h-64",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(re,{data:Z,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(E,{dataKey:"range"}),e.jsx(F,{allowDecimals:!1}),e.jsx(k,{}),e.jsx(le,{dataKey:"value",fill:"#3b82f6"})]})})})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(x,{children:"Avg Cycle Time"})}),e.jsx(m,{children:e.jsxs("div",{className:"text-3xl font-bold",children:[W.toFixed(1),"d"]})})]}),e.jsxs(d,{className:"md:col-span-2",children:[e.jsx(h,{children:e.jsx(x,{children:"Assignee Throughput (30d)"})}),e.jsx(m,{children:e.jsxs("ul",{className:"space-y-2",children:[_.map(s=>e.jsxs("li",{className:"flex items-center justify-between",children:[e.jsx("span",{children:s.login}),e.jsx(K,{variant:"secondary",children:s.count})]},s.login)),!_.length&&e.jsx("div",{className:"text-sm text-gray-500",children:"No data."})]})})]})]})]})}export{Ne as default};
